<!DOCTYPE html>
<html
  lang="ko"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>recycleList</title>

    <!-- jQuery 스크립트 파일 불러오기 -->
    <script th:src="@{/js/jquery-3.7.1.min.js}"></script>

    <style type="text/css">
      /* 중앙 정렬 및 최대 너비 설정 */
      .fixed_img_col {
        margin: 0 auto;
        text-align: center;
        max-width: 1600px;
      }

      /* 리스트 스타일 초기화 및 수평 정렬 */
      .fixed_img_col ul {
        list-style: none;
        padding: 0;
        display: inline-block;
      }

      /* 각 이미지 항목에 대한 마진 설정 */
      .fixed_img_col ul li {
        display: inline-block;
        margin: 5px;
      }

      /* 이미지 크기 설정 및 비율 유지 */
      .fixed_img_col ul li img {
        width: 300px;
        height: 300px;
        object-fit: cover;
      }

      /* 팝업 오버레이 (배경) 스타일 설정 */
      .popup-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
      }

      /* 팝업창 스타일 설정 */
      .popup-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        display: flex;
        width: 700px; /* 팝업 너비 조정 */
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
      }

      /* 팝업창 왼쪽 영역: 이미지 */
      .popup-left {
        flex: 1;
      }

      /* 팝업창 오른쪽 영역: 텍스트 내용 */
      .popup-right {
        flex: 1;
        padding-left: 15px; /* 이미지와 텍스트 사이 여백 */
      }

      /* 팝업 이미지 스타일 */
      .popup-left img {
        width: 100%;
        height: auto; /* 이미지 비율 유지 */
        max-height: 400px; /* 최대 높이 설정 */
        object-fit: cover;
      }

      /* 닫기 버튼 스타일 */
      .close-btn {
        float: right;
        cursor: pointer;
      }

      /* 텍스트 스타일 설정 */
      .popup-right h2 {
        margin: 0;
        font-size: 22px;
        border-bottom: 1px solid black;
        padding-bottom: 10px;
      }

      .popup-right p {
        font-size: 16px;
        margin: 10px 0;
      }

      .popup-right .category {
        margin-bottom: 15px;
        font-weight: bold;
      }

      .popup-right .updated-date {
        font-size: 12px;
        color: gray;
        margin-top: 10px;
      }
    </style>

    <script>
      // 팝업창 열기 함수: 아이템 번호에 따라 데이터 불러오기
      function openPopup(recycleNum) {
        fetch(`/recycle/read?recycleNum=` + recycleNum)
          .then((response) => response.json())
          .then((data) => {
            // 팝업 내용 업데이트
            document.getElementById("popupTitle").textContent =
              data.recycleName;
            document.getElementById("popupContents").textContent =
              data.recycleContents;
            document.getElementById("popupCategory").textContent =
              data.recycleCategory;
            document.getElementById("popupDate").textContent = data.recycleDate;

            // 팝업 이미지 업데이트
            document.getElementById("popupImage").src =
              `/images/` + data.recycleFileName;

            // 팝업창 표시
            document.querySelector(".popup-overlay").style.display = "block";
          })
          .catch((error) => {
            console.error("데이터를 불러오는 중 오류 발생:", error);
            alert("데이터를 불러오는 데 실패했습니다.");
          });
      }

      // 팝업창 닫기 함수
      function closePopup() {
        document.querySelector(".popup-overlay").style.display = "none";
      }

      // 팝업 외부 클릭 시 닫기
      window.addEventListener("click", function (event) {
        var popupContent = document.querySelector(".popup-content");
        var popupOverlay = document.querySelector(".popup-overlay");

        if (
          event.target === popupOverlay &&
          !popupContent.contains(event.target)
        ) {
          closePopup();
        }
      });

      // ESC 키 누르면 팝업 닫기
      document.addEventListener("keydown", function (event) {
        if (event.key === "Escape") {
          closePopup();
        }
      });
    </script>
  </head>
  <body>
    <div class="wrap">
      <div class="fixed_img_col">
        <ul>
          <!-- 이미지 리스트 출력 -->
          <th:block th:each="item : ${recycleList}">
            <li>
              <a
                href="javascript:void(0)"
                th:onclick="'openPopup(' + ${item.recycleNum} + ')'"
              >
                <img
                  th:src="@{'/images/' + ${item.recycleFileName}}"
                  alt="이미지"
                  width="300px"
                  height="300px"
                />
              </a>
            </li>
          </th:block>
        </ul>
      </div>

      <!-- 팝업창 구조 -->
      <div class="popup-overlay">
        <div class="popup-content">
          <!-- 왼쪽: 이미지 -->
          <div class="popup-left">
            <img
              id="popupImage"
              src=""
              alt="게시물 이미지"
              style="width: 300px; height: 300px; object-fit: cover"
            />
          </div>

          <!-- 오른쪽: 텍스트 내용 -->
          <div class="popup-right">
            <span class="close-btn" onclick="closePopup()">X</span>
            <h2 id="popupTitle">제목</h2>
            <p id="popupCategory" class="category">카테고리</p>
            <p id="popupContents">내용</p>
            <p id="popupDate" class="updated-date">최종 업데이트 날짜</p>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
