<!DOCTYPE html>
<html
  lang="ko"
  xmlns:th="http://thymeleaf.org"
  xmlns:sec="http://thymeleaf.org/extras/spring-security"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script th:src="@{/js/jquery-3.7.1.min.js}"></script>
    <script>
      $(document).ready(function () {
        $("#joinPost").submit(check);
      });

      function onlyAlphaNum(input) {
        const regex = /^[A-Za-z0-9_]*$/; // 영문, 숫자, 언더바만 허용하는 정규 표현식
        if (!regex.test(input.value)) {
          // 입력된 값이 정규 표현식과 맞지 않으면 값을 수정
          input.value = input.value.replace(/[^A-Za-z0-9_]/g, "");
        }
      }

      function winOpenId() {
        let memberId = $("#memberId").val().trim();
        let memberNickname = $("#memberNickname").val().trim();
        let divide = "i";

        if (memberId == "") {
          alert("ID를 입력하세요.");
          return false;
        }

        $("#sendToChild").val(divide);

        let w = window.open(
          "/member/idCheck?memberId=" +
            memberId +
            "&memberNickname=" +
            memberNickname,
          "win",
          "top=100, left=400, width=500, height=600"
        );
      }

      function winOpenNick() {
        let memberId = $("#memberId").val().trim();
        let memberNickname = $("#memberNickname").val().trim();
        let divide = "n";

        if (memberNickname == "") {
          alert("닉네임을 입력하세요.");
          return false;
        }

        $("#sendToChild").val(divide);

        let w = window.open(
          "/member/idCheck?memberId=" +
            memberId +
            "&memberNickname=" +
            memberNickname,
          "win",
          "top=100, left=400, width=500, height=600"
        );
      }

      function check() {
        let id = $("#memberId").val();
        let pw = $("#memberPw").val();
        let pwCheck = $("#pwCheck").val();
        let email = $("#memberEmail").val();
        let nickname = $("#memberNickname").val();
        let idDuplicationCheck = $("#idDuplicationCheck").val();
        let nickDuplicationCheck = $("#nickDuplicationCheck").val();

        if (id == "") {
          alert("아이디를 입력해주세요.");
          return false;
        }

        if (id.length < 4 || id.length > 12) {
          alert("아이디는 4자 이상 12자 이하로 입력해주세요.");
          return false;
        }

        if (pw == "") {
          alert("비밀번호를 입력해주세요.");
          return false;
        }

        if (pw.length < 8) {
          alert("비밀번호는 8자 이상으로 입력해주세요.");
          return false;
        }

        // if (email == "") {
        //   alert("이메일을 입력해주세요.");
        //   return false;
        // }

        if (nickname == "") {
          alert("닉네임을 입력해주세요.");
          return false;
        }

        if (pw != pwCheck) {
          alert("비밀번호가 일치하지 않습니다.");
          return false;
        }

        if (!idDuplicationCheck == "y" || !nickDuplicationCheck == "y") {
          alert("아이디 혹은 닉네임 중복 확인이 이루어지지 않았습니다");
          return false;
        }
      }
    </script>
  </head>
  <body>
    <h1>[ 회원 가입 ]</h1>
    <form th:action="@{/member/join}" method="post" id="joinPost">
      <table>
        <tr>
          <th>ID</th>
          <td>
            <input
              type="text"
              name="memberId"
              id="memberId"
              maxlength="12"
              oninput="onlyAlphaNum(this)"
            />
            <input
              type="button"
              id="idCheck"
              value="ID중복확인"
              onclick="winOpenId()"
            />
          </td>
        </tr>

        <tr>
          <th>PW</th>
          <td>
            <input type="password" name="memberPw" id="memberPw" />
          </td>
        </tr>

        <tr>
          <th>PW 확인</th>
          <td><input type="password" id="pwCheck" /></td>
        </tr>

        <tr>
          <th>이메일</th>
          <td>
            <input type="text" name="memberEmail" id="memberEmail" />
            <input type="button" value="인증번호 전송" id="emailButton" />
          </td>
        </tr>

        <tr>
          <th>닉네임</th>
          <td>
            <input
              type="text"
              name="memberNickname"
              id="memberNickname"
              onkeyup="this.value=this.value.replace(' ','')"
            />
            <input
              type="button"
              value="닉네임중복확인"
              id="nickButton"
              onclick="winOpenNick()"
            />
          </td>
        </tr>
      </table>
      <input type="hidden" id="sendToChild" />
      <input type="hidden" id="idDuplicationCheck" />
      <input type="hidden" id="nickDuplicationCheck" />
      <input type="submit" value="회원가입" id="postButton" />
    </form>
  </body>
</html>
